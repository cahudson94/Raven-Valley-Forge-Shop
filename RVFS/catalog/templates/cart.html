{% extends 'rvfsite/base.html' %}
{% load thumbnail %}
{% load mathfilters %}
{% load static %}

{% block title %}Cart{% endblock %}

{% block body %}
<form enctype="multipart/form-data" method="post">
    {% csrf_token %}
    <h2 class="text-standard">Cart</h2>
    <div id='cart' class="row acc-row">
    {% if cart %}
        {% if prods %}
        <h3 class="section-head text-standard">Products:</h3>
        <ul class="row acc-list-row">
        {% for item in prods %}
            {% if forloop.counter0|mod:4 == 0 and forloop.counter0 > 0 %}
            </ul>
            <ul class="row acc-list-row">
                <li id="prod {{ forloop.counter0 }}" class="card account-list">
                        <div class="row">
                            <div class="col">
                                {% thumbnail item.item.image "100x100" crop="center" as pic %}
                                <img src="{{ pic.url }}" width="{{ pic.width }}" height="{{ pic.height }}">
                                {% endthumbnail %}
                                <a class="acc-item-link" href="{% url 'prod' item.item_id %}"><h4 class="text-standard">{{ item.item.name }}</h4></a>
                            </div>
                            <div class="col">
                                <label class="text-standard">Quantity:</label>
                                <select name="{{ item.count }}" onchange="updatecart(this.value, this.name)">
                                    <option value="1" {% if item.quantity == '1' %}selected{% endif %}>1</option>
                                    <option value="2" {% if item.quantity == '2' %}selected{% endif %}>2</option>
                                    <option value="3" {% if item.quantity == '3' %}selected{% endif %}>3</option>
                                    <option value="4" {% if item.quantity == '4' %}selected{% endif %}>4</option>
                                    <option value="5" {% if item.quantity == '5' %}selected{% endif %}>5</option>
                                </select>
                                {% for field, value in item.items %}
                                    {% if field in item_fields %}
                                    <h5 class="text-standard">{{ field }}: {{ value }}</h5>
                                    {% endif %}
                                {% endfor %}
                                <h5 class="text-standard">${{ item.item.price }} per unit</h5>
                                <div class="del-button d-flex">
                                    <button class="delete btn btn-danger ml-auto" data-item="{{ item.count }}" type="button">remove</button>
                                </div>
                            </div>
                        </div>
                </li>
            {% else %}
                <li id="prod {{ forloop.counter0 }}" class="card account-list">
                    <div class="row">
                        <div class="col">
                            {% thumbnail item.item.image "100x100" crop="center" as pic %}
                                <img src="{{ pic.url }}" width="{{ pic.width }}" height="{{ pic.height }}">
                            {% endthumbnail %}
                            <a class="acc-item-link" href="{% url 'prod' item.item_id %}"><h4 class="text-standard">{{ item.item.name }}</h4></a>
                        </div>
                        <div class="col">
                            <label class="text-standard">Quantity:</label>
                            <select name="{{ item.count }}" onchange="updatecart(this.value, this.name)">
                                <option value="1" {% if item.quantity == '1' %}selected{% endif %}>1</option>
                                <option value="2" {% if item.quantity == '2' %}selected{% endif %}>2</option>
                                <option value="3" {% if item.quantity == '3' %}selected{% endif %}>3</option>
                                <option value="4" {% if item.quantity == '4' %}selected{% endif %}>4</option>
                                <option value="5" {% if item.quantity == '5' %}selected{% endif %}>5</option>
                            </select>
                            {% for field, value in item.items %}
                                {% if field in item_fields %}
                                <h5 class="text-standard">{{ field }}: {{ value }}</h5>
                                {% endif %}
                            {% endfor %}
                            <h5 class="text-standard">${{ item.item.price }} per unit</h5>
                            <div class="del-button d-flex">
                                <button class="delete btn btn-danger ml-auto" data-item="{{ item.count }}" type="button">remove</button>
                            </div>
                        </div>
                    </div>
                </li>
            {% endif %}
        {% endfor %}
        </ul>
        {% endif %}
        {% if servs %}
        <h3 class="section-head text-standard">Services:</h3>
        <ul class="row acc-list-row">
        {% for item in servs %}
            {% if forloop.counter0|mod:4 == 0 %}
            </ul>
            <ul class="row acc-list-row">
                <li id="serv {{ forloop.counter0 }}" class="card account-list">
                    <div class="row">
                        <div class="col">
                            {% thumbnail item.item.image "100x100" crop="center" as pic %}
                            <img src="{{ pic.url }}" width="{{ pic.width }}" height="{{ pic.height }}">
                            {% endthumbnail %}
                            <a class="acc-item-link" href="{% url 'prod' item.item_id %}"><h4 class="text-standard">{{ item.item.name }}</h4></a>
                        </div>
                        <div class="col">
                            {% for field, value in item.items %}
                                {% if field in item_fields %}
                                <h5 class="text-standard">{{ field }}: {{ value }}</h5>
                                {% endif %}
                            {% endfor %}
                            {% if item.item.commission_fee %}
                            <h5 class="text-standard">${{ item.item.commission_fee }} fee</h5>
                            {% endif %}
                            {% if item.item.price_range %}
                            <h5 class="text-standard">${{ item.item.price_range }} price range</h5>
                            {% endif %}
                            <div class="del-button d-flex">
                                <button class="delete btn btn-danger ml-auto" data-item="{{ item.count }}" type="button">remove</button>
                            </div>
                        </div>
                    </div>
                </li>
            {% else %}
                <li id="serv {{ forloop.counter0 }}" class="card account-list">
                    <div class="row">
                        <div class="col">
                            {% thumbnail item.item.image "100x100" crop="center" as pic %}
                                <img src="{{ pic.url }}" width="{{ pic.width }}" height="{{ pic.height }}">
                            {% endthumbnail %}
                            <a class="acc-item-link" href="{% url 'prod' item.item_id %}"><h4 class="text-standard">{{ item.item.name }}</h4></a>
                        </div>
                        <div class="col">
                            {% for field, value in item.items %}
                                {% if field in item_fields %}
                                <h5 class="text-standard">{{ field }}: {{ value }}</h5>
                                {% endif %}
                            {% endfor %}
                            {% if item.item.commission_fee %}
                            <h5 class="text-standard">${{ item.item.commission_fee }} fee</h5>
                            {% endif %}
                            {% if item.item.price_range %}
                            <h5 class="text-standard">${{ item.item.price_range }} price range</h5>
                            {% endif %}
                            <div class="del-button d-flex">
                                <button class="delete btn btn-danger ml-auto" data-item="{{ item.count }}" type="button">remove</button>
                            </div>
                        </div>
                    </div>
                </li>
            {% endif %}
        {% endfor %}
        </ul>
        {% endif %}
    {% else %}
    <h5 class="w-100 text-standard">Your cart is empty.</h5>
    <div class="placeholder"></div>
    {% endif %}
    </div>
    <div class="w-100">
        <h3 id="total" class="text-right text-standard">Total:
            {% if account.cart_total %}
                {% if account.cart_total.endswith == 0 %}
                    ${{ account.cart_total }}0
                {% else %}
                    ${{ account.cart_total }}
                {% endif %}
            {% else %}
            $0
            {% endif %}
        </h3>
    </div>
    {% if account.cart_total or serv_address %}
    <div id="shipping">
    <img class="dividor" src="{% static 'arrow-divider.png' %}">
    <div class="row acc-row">
        {% if account.cart_total %}
        <ul class="col">
        <h2 class="text-standard">Shipping Info:</h2>
        {% if user.is_authenticated %}
            {% if alt_add %}
            <li class="account-list">
            <label class="text-standard">Address:</label>
            <select id="ship_address_name" name="ship_address_name">
                {% for add in alt_add %}
                    {% if not ship_exists and add.main %}
                    <option value="{{ add }}" selected="selected">{{ add.name }}</option>
                    {% elif ship_exists and add.id == ship_exists %}
                    <option value="{{ add }}" selected="selected">{{ add.name }}</option>
                    {% else %}
                    <option value="{{ add }}">{{ add.name }}</option>
                    {% endif %}
                {% endfor %}
            </select>
            </li>
            {% endif %}
        {% endif %}
        <li class="account-list">
        <label class="text-standard">First Name:</label>
        <br>
        <input id="first_name" type="text" name="ship_first_name" value="{% if info %}{{ info.first }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">Last Name:</label>
        <br>
        <input id="last_name" type="text" name="ship_last_name" value="{% if info %}{{ info.last }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">Email:</label>
        <br>
        <input id="email" type="text" name="ship_email" value="{% if info %}{{ info.email }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">Address Line 1:</label>
        <br>
        <input id="ship_add_1" type="text" name="ship_add_1" value="{% if shipping %}{{ shipping.address1 }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">Address Line 2:</label>
        <br>
        <input id="ship_add_2" type="text" name="ship_add_2" value="{% if shipping %}{{ shipping.address2 }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">City:</label>
        <br>
        <input id="ship_city" type="text" name="ship_city" value="{% if shipping %}{{ shipping.city }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">State:</label>
        <br>
        <input id="ship_state" type="text" name="ship_state" value="{% if shipping %}{{ shipping.state }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">Zip Code:</label>
        <br>
        <input id="ship_zip" type="text" name="ship_zip" value="{% if shipping %}{{ shipping.zip_code }}{% endif %}">
        </li>
        </ul>
        {% endif %}
        {% if serv_address %}
        <ul class="col">
        <h2 class="text-standard">Service Address:</h2>
        {% if user.is_authenticated %}
            {% if alt_add %}
            <li class="account-list">
            <label class="text-standard">Address:</label>
            <select id="serv_address_name" name="serv_address_name">
                {% for add in alt_add %}
                    {% if not serv_exists and add.main %}
                    <option value="{{ add }}" selected="selected">{{ add.name }}</option>
                    {% elif serv_exists and add.id == serv_exists %}
                    <option value="{{ add }}" selected="selected">{{ add.name }}</option>
                    {% else %}
                    <option value="{{ add }}">{{ add.name }}</option>
                    {% endif %}
                {% endfor %}
            </select>
            </li>
            {% endif %}
        {% endif %}
        <li class="account-list">
        <label class="text-standard">First Name:</label>
        <br>
        <input id="first_name" type="text" name="serv_first_name" value="{% if serv_info %}{{ serv_info.first }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">Last Name:</label>
        <br>
        <input id="last_name" type="text" name="serv_last_name" value="{% if serv_info %}{{ serv_info.last }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">Email:</label>
        <br>
        <input id="email" type="text" name="serv_email" value="{% if serv_info %}{{ serv_info.email }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">Address Line 1:</label>
        <br>
        <input id="serv_add_1" type="text" name="serv_add_1" value="{% if serv_add %}{{ serv_add.address1 }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">Address Line 2:</label>
        <br>
        <input id="serv_add_2" type="text" name="serv_add_2" value="{% if serv_add %}{{ serv_add.address2 }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">City:</label>
        <br>
        <input id="serv_city" type="text" name="serv_city" value="{% if serv_add %}{{ serv_add.city }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">State:</label>
        <br>
        <input id="serv_state" type="text" name="serv_state" value="{% if serv_add %}{{ serv_add.state }}{% endif %}">
        </li>
        <li class="account-list">
        <label class="text-standard">Zip Code:</label>
        <br>
        <input id="serv_zip" type="text" name="serv_zip" value="{% if serv_add %}{{ serv_add.zip_code }}{% endif %}">
        </li>
        </ul>
        {% endif %}
    </div>
    <div class="w-100 d-flex">
        <input class="btn btn-secondary text-standard ml-auto" type="submit" name="check" value="Continue Checkout with PayPal">
    </div>
    </div>
    {% endif %}
</form>
{% endblock %}

{% if alt_add %}
{% block js %}

<script src="{% static 'js/update_cart.js' %}"></script>

{% endblock %}
{% endif %}